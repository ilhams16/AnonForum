@using System.Text.Json
@using AnonForum.BLL.DTOs.User
@{
	ViewData["Title"] = "Home Page";
}
@model AnonForum.MVC.Models.PostAndCategoryViewModel

<div class="row">
	<div class="col-lg-12">
		<!-- Basic Card Example -->
		<div class="card shadow mb-4 p-2">
			@if (Context.Session.GetString("userLogin") != null)
			{
				<div class="card-header py-3">
					<h6 class="m-0 font-weight-bold text-primary">
						Welcome
					</h6>
				</div>
			}
			<div class="card-body">
				<div class="d-flex">
					@using (Html.BeginForm("Index", "Home", FormMethod.Get))
					{
						<p class="d-flex justify-content-between">
							<input type="text" id="search" class="form-control" name="search"
								   placeholder="Search by title" />
							&nbsp;
							<input type="submit" class="btn btn-info btn-sm mx-2" value="Search" />
						</p>
					}
					@using (Html.BeginForm("Index", "Home", FormMethod.Get))
					{
						<div class="form-group d-flex justify-content-between">
							<select id="category" name="category" class="form-control">
								<option value="">All Categories</option>
								@foreach (var category in Model.Categories)
								{
									<option value="@category.PostCategoryID">@category.Name</option>
								}
							</select>
							&nbsp;
							<input type="submit" class="btn btn-info btn-sm mx-2" value="Search" />
						</div>
					}
				</div>

				<a href="/Posts/Create" class="btn btn-success btn-sm my-3">Create New Post</a>&nbsp;
				<div class="row">
					@foreach (var post in Model.Posts)
					{
						<div class="mb-4">
							<div class="card">
								<div class="card-body text-center">
									<div class="d-flex justify-content-start align-content-center align-items-center">
										<div class="mx-1"><img src="/Image/UserImages/@post.UserImage" width="30" alt="User Image" /></div>
										<div class="mx-1">@post.Username</div>
									</div>
									<h5 class="card-title">@post.Title</h5>
									<p class="card-text text-start">@post.PostText</p>
									@if (!string.IsNullOrEmpty(post.Image))
									{
										<div class="m-auto">
											<img src="/Image/PostImages/@post.Image" class="img-fluid rounded w-50 h-50" alt="Post Image" />
										</div>
									}
									<div class="d-flex justify-content-between mt-3">
										<p class="card-text"><strong>Category:</strong> @post.CategoryName</p>
										<p class="card-text text-muted">Published on: @post.TimeStamp.ToString("dddd, dd MMMM yyyy")</p>
									</div>
									<div class="mt-3 text-end">
										<a href="/Posts/Edit/@post.PostID" class="btn btn-warning btn-sm mr-2">Edit</a>
										<a href="/Posts/Delete/@post.PostID" class="btn btn-danger btn-sm">Delete</a>
									</div>
								</div>
							</div>
						</div>

					}
				</div>

			</div>
		</div>

	</div>
</div>